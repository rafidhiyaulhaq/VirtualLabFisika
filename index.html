<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Lab Fisika</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Additional styles specific to index page */
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-email {
            color: #4b5563;
            font-size: 0.875rem;
        }

        .restricted {
            display: none;
        }

        .progress-overview {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-top: 2rem;
        }

        .progress-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .progress-item {
            text-align: center;
            padding: 1rem;
            background: #f3f4f6;
            border-radius: 0.375rem;
        }

        .progress-item h4 {
            color: #4b5563;
            margin-bottom: 0.5rem;
        }

        .progress-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3b82f6;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <div class="logo">Virtual Lab Fisika</div>
            <nav class="nav-links">
                <a href="#beranda" class="nav-link">Beranda</a>
                <a href="#materi" class="nav-link">Materi</a>
                <a href="#simulasi" class="nav-link">Simulasi</a>
                <div id="userSection" style="display: none;">
                    <div class="user-info">
                        <span id="userEmail" class="user-email"></span>
                        <button id="logoutButton" class="nav-button">Logout</button>
                    </div>
                </div>
                <div id="authSection">
                    <a href="login.html" class="nav-button">Login</a>
                </div>
            </nav>
        </div>
    </header>

    <section id="beranda" class="hero">
        <div class="hero-content">
            <h1 class="hero-title">Virtual Lab Fisika</h1>
            <p class="hero-description">Pelajari fisika melalui simulasi interaktif dan materi pembelajaran yang menarik</p>
            <div class="hero-buttons">
                <a href="parabola.html" class="primary-button restricted">Mulai Simulasi Parabola</a>
                <a href="#materi" class="secondary-button">Pelajari Materi</a>
            </div>
        </div>
    </section>

    <main>
        <section id="highlight" class="stats-section">
            <div class="stats-container">
                <div class="stat-item">
                    <h3 class="stat-title">Simulasi Interaktif</h3>
                    <p>Pahami konsep fisika melalui eksperimen virtual</p>
                </div>
                <div class="stat-item">
                    <h3 class="stat-title">Progress Tracking</h3>
                    <p>Pantau perkembangan pembelajaran Anda</p>
                </div>
                <div class="stat-item">
                    <h3 class="stat-title">Materi Lengkap</h3>
                    <p>Pembelajaran fisika yang komprehensif</p>
                </div>
            </div>
        </section>

        <section id="materi" class="materials-section">
            <div class="materials-container">
                <h2 class="section-title">Materi Pembelajaran</h2>
                <div class="materials-grid">
                    <div class="material-card">
                        <div class="card-header">
                            <h3>Gerak Parabola</h3>
                        </div>
                        <div class="card-content">
                            <ul>
                                <li>Pengertian Gerak Parabola</li>
                                <li>Komponen Gerak</li>
                                <li>Rumus dan Perhitungan</li>
                                <li>Contoh Soal</li>
                            </ul>
                            <a href="parabola.html" class="card-button restricted">Mulai Simulasi</a>
                        </div>
                    </div>

                    <div class="material-card">
                        <div class="card-header">
                            <h3>Dinamika Gerak</h3>
                        </div>
                        <div class="card-content">
                            <ul>
                                <li>Hukum Newton</li>
                                <li>Gaya dan Percepatan</li>
                                <li>Momentum</li>
                                <li>Aplikasi</li>
                            </ul>
                            <a href="#" class="card-button">Segera Hadir</a>
                        </div>
                    </div>

                    <div class="material-card">
                        <div class="card-header">
                            <h3>Energi Mekanik</h3>
                        </div>
                        <div class="card-content">
                            <ul>
                                <li>Energi Potensial</li>
                                <li>Energi Kinetik</li>
                                <li>Hukum Kekekalan</li>
                                <li>Penerapan</li>
                            </ul>
                            <a href="#" class="card-button">Segera Hadir</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="progress" class="progress-overview restricted">
            <div class="materials-container">
                <h2 class="section-title">Progress Pembelajaran</h2>
                <div class="progress-grid">
                    <div class="progress-item">
                        <h4>Total Simulasi</h4>
                        <div id="totalSimulations" class="progress-value">0</div>
                    </div>
                    <div class="progress-item">
                        <h4>Skor Terbaik</h4>
                        <div id="bestScore" class="progress-value">0</div>
                    </div>
                    <div class="progress-item">
                        <h4>Simulasi Terakhir</h4>
                        <div id="lastSimulation" class="progress-value">-</div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p>Virtual Lab Fisika Â© 2024</p>
        <p>Dibuat oleh Muhammad Rafi Dhiyaulhaq - 18222069</p>
    </footer>

    <script type="module">
        import { initializeApp } from 'firebase/app';
        import { getAuth, onAuthStateChanged, signOut } from 'firebase/auth';
        import { getFirestore, doc, getDoc } from 'firebase/firestore';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD4CYi9sjsW79ZiLcerhhOmIFR-Ygd8Ueo",
            authDomain: "virtual-physics-lab.firebaseapp.com",
            projectId: "virtual-physics-lab",
            storageBucket: "virtual-physics-lab.firebasestorage.app",
            messagingSenderId: "892280026110",
            appId: "1:892280026110:web:9e7a605138121b324106af",
            measurementId: "G-R3KWNLMH9G"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // DOM elements
        const userSection = document.getElementById('userSection');
        const authSection = document.getElementById('authSection');
        const userEmail = document.getElementById('userEmail');
        const logoutButton = document.getElementById('logoutButton');
        const restrictedElements = document.querySelectorAll('.restricted');

        // Update progress display
        async function updateProgressDisplay(userId) {
            try {
                const userDoc = await getDoc(doc(db, 'users', userId));
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    const progress = userData.progress || {};
                    const parabolaProgress = progress.parabolaSimulation || {};

                    // Update progress elements if they exist
                    const totalSimulations = document.getElementById('totalSimulations');
                    const bestScore = document.getElementById('bestScore');
                    const lastSimulation = document.getElementById('lastSimulation');

                    if (totalSimulations) {
                        totalSimulations.textContent = progress.completedSimulations || 0;
                    }
                    if (bestScore) {
                        bestScore.textContent = parabolaProgress.bestScore || 0;
                    }
                    if (lastSimulation && parabolaProgress.lastAttempt) {
                        const lastDate = new Date(parabolaProgress.lastAttempt.toDate());
                        lastSimulation.textContent = lastDate.toLocaleDateString();
                    }
                }
            } catch (error) {
                console.error('Error getting user data:', error);
            }
        }

        // Auth state observer
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // User is signed in
                userSection.style.display = 'block';
                authSection.style.display = 'none';
                userEmail.textContent = user.email;

                // Show restricted content
                restrictedElements.forEach(el => el.style.display = 'block');

                // Update progress display
                await updateProgressDisplay(user.uid);
            } else {
                // User is signed out
                userSection.style.display = 'none';
                authSection.style.display = 'block';
                userEmail.textContent = '';

                // Hide restricted content
                restrictedElements.forEach(el => el.style.display = 'none');
            }
        });

        // Logout handler
        if (logoutButton) {
            logoutButton.addEventListener('click', async () => {
                try {
                    await signOut(auth);
                    window.location.href = 'login.html';
                } catch (error) {
                    console.error('Error signing out:', error);
                }
            });
        }

        // Protect restricted links
        document.querySelectorAll('a[href="parabola.html"]').forEach(link => {
            link.addEventListener('click', (e) => {
                if (!auth.currentUser) {
                    e.preventDefault();
                    window.location.href = 'login.html';
                }
            });
        });
    </script>
</body>
</html>